## Preprocessing

### Raw Data
The raw data for this project was kindly provided by Dr. Katie Greenham from the College of Biological Sciences at the University of Minnesota. This included RNAseq data generated using Illumina NovaSeq 6000 S4 with the objective of identifying differentially expressed genes associated with circadian patterns and cold hardiness, using multiple cultivars of Brassica rapa, a 32 h period with 4 h intervals, and four replicates. On April 11, 2023, we obtained the normalized counts ('tpm_counts.txt') as transcript per million (TPM) for 39,581 genes that were mapped to the B. rapa subsp. trilocularis (Yellow Sarson) variety R500 reference genome (Lou et al., 2020). We also received the metadata for the libraries ('LIBRARIES_KEY.txt') containing information for all genotypes, which enabled us to begin the filtering and preprocessing steps. We later received the genomes files (FASTA) for genotypes R500, L58, W083, A03, VT123 PCGlu and O302V, and their JGI annotations in General Feature Format (GFF3). All raw and processed files can be located at "/home/myersc/jbarreto/CSCI5461'' through the Minnesota Supercomputing Institute (MSI), the code for the further steps can be openly accessed from the Github repository https://github.com/joanmanbar/CSCI5461_2023_FinalProject and associated forks.

### Filtering 
For the purpose of this project, we ignored the expression count from the cold treatment and only focused on seven time points on the control data for the genotypes with available genomes. After this filtering step, we added columns with NA values for genotypes missing replicates or timepoints, as required by MetaCycle (Wu et al., 2016), the R tool we used to identify circadian genes.

### Identifying Circadian Genes
We screened for circadian genes, using the "JTK_CYCLE" algorithm with timepoints 17, 21, 25, 29, 33, 37, 41, and the function "meta2d" with default values. The results from the complete analysis comprises a .txt file per genotype with the gene id, as well as their period, amplitude, and phase, the latter being the phenotype of choice to predict. The output also includes p-values adjusted with the Benjamini-Hochberg method, which we used to determine whether a gene was circadian or not based on a threshold lower than 1%.            

### Accessing Promoter Regions
Because the expression data were mapped to R500, we required pairwise syntenic hits for the other JGI genotypes of interest. We received this data on April 19, and began the steps to identify promoter regions using the SAMtools (Li et al., 2009) and BEDTools (Quinlan & Hall, 2020) programs, on MSI. For this analysis, we created a .bash file (get_2kb_fasta.sh) that begins with renaming FASTA files for convenience, and loops through each genome to first generate an index file (.fai) using the 'faidx' function from SAMtools that helps generate the file with chromosome sizes ('chrom.sizes'). Next, we read genome's GFF3 file and filter it to contain only genes, and this gets converted to a .bed file with gene coordinates that is used along with the 'chrom.sizes' file as inputs for the 'flank' function in BEDTools that generates the coordinates for the 2kb sequence upstream the promoter region that we aim to extract. On April 25, we finally identified those regions using the as input for the 'getfasta' function from BEDTools the files generated in previous steps. 

### Feature extraction
Transcription factor binding sites range from 5 to 15 base pairs (bp) within the promoter region or Arabidopsis (Fujita et al., 2016), a close relative of B. rapa. However, extracting features that represent those potential sites from a DNA sequence is challenging despite the multiple ways to accomplish it. Our approach relied on a slide window of 8bp across the 2kb sequence to extract sequences with an overlap of 3bp, such that these sequences can then be one-hot-encoded as features representing presence (one) or absence (zero) of the sequences across genes (see example GeneFeatures_v01.ipynb in Github repository). This resulted in 399 features per gene and a total of 65,375 features assessed for presence or absence across genes, i.e., a 55,894 by 65,375 matrix with binary data. This highly sparse and redundant matrix with more features than observations, had density distribution ranging from 2-25,000, where the 25th, 50th, and 75th percentiles were 104, 195, and 24,500, respectively. This indicates a need for feature selection, for example, based on density, cosine similarity, or dimensional reduction methods such as principal component analysis, before fitting regression models. 